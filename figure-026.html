<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Figure 026: Linear-Quadratic Systems</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@700;800;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: #1f2937;
            color: white;
            min-height: 100vh;
            overflow: hidden;
        }

        #game-container {
            max-width: 480px;
            margin: 0 auto;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #top-bar {
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .close-btn {
            width: 40px;
            height: 40px;
            background: none;
            border: none;
            color: #9ca3af;
            font-size: 32px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 300;
        }

        #progress-container {
            flex: 1;
            position: relative;
        }

        #streak-label {
            position: absolute;
            top: -20px;
            left: 0;
            font-size: 13px;
            font-weight: 900;
            color: #fbbf24;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        #progress-bg {
            width: 100%;
            height: 16px;
            background: #374151;
            border-radius: 20px;
            overflow: hidden;
        }

        #progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #fbbf24 0%, #f59e0b 100%);
            width: 0%;
            transition: width 0.4s ease;
            border-radius: 20px;
        }

        #content {
            flex: 1;
            padding: 0 20px 20px 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .mode-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
        }

        .mode-badge.learn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .mode-badge.practice {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }

        .mode-badge.challenge {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .concept-box {
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #10b981;
        }

        .concept-text {
            font-size: 18px;
            font-weight: 700;
            color: #d1d5db;
            line-height: 1.6;
            margin-bottom: 16px;
        }

        #question-text {
            font-size: 20px;
            font-weight: 900;
            line-height: 1.5;
            margin-bottom: 20px;
            color: white;
        }

        #choices {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .choice {
            background: #374151;
            border: 3px solid transparent;
            border-radius: 12px;
            padding: 16px 20px;
            font-size: 16px;
            font-weight: 800;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            line-height: 1.5;
            position: relative;
            padding-left: 50px;
        }

        .choice::before {
            content: attr(data-letter);
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 28px;
            height: 28px;
            background: #4b5563;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 900;
            color: #9ca3af;
        }

        .choice:hover {
            background: #4b5563;
            border-color: #6b7280;
            transform: translateY(-2px);
        }

        .choice.selected {
            border-color: #fbbf24;
            background: #4b5563;
        }

        .choice.correct {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #10b981;
            animation: correctPulse 0.6s ease;
        }

        .choice.correct::before {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .choice.incorrect {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-color: #ef4444;
            animation: shake 0.4s ease;
        }

        .choice.incorrect::before {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .choice:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        #feedback {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 16px;
            min-height: 40px;
        }

        .check-icon {
            width: 32px;
            height: 32px;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s ease;
        }

        .check-icon.show {
            opacity: 1;
            transform: scale(1);
        }

        #feedback-text {
            font-size: 18px;
            font-weight: 900;
            color: #10b981;
        }

        #continue-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border: none;
            border-radius: 16px;
            font-size: 18px;
            font-weight: 900;
            color: #1f2937;
            cursor: pointer;
            margin-top: 20px;
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
            transition: all 0.3s ease;
        }

        #continue-btn.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }

        #continue-btn:active {
            transform: scale(0.98);
        }

        #victory {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }

        #victory.show {
            opacity: 1;
            pointer-events: all;
        }

        .victory-content {
            text-align: center;
            padding: 40px;
            max-width: 400px;
        }

        .victory-icon {
            font-size: 80px;
            margin-bottom: 24px;
            animation: victoryBounce 0.8s ease;
        }

        @keyframes victoryBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        #victory-msg {
            font-size: 28px;
            font-weight: 900;
            margin-bottom: 16px;
            color: white;
        }

        #victory-badges {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 24px 0;
            flex-wrap: wrap;
        }

        .badge {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 900;
            color: #1f2937;
            text-transform: uppercase;
        }

        .victory-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            border-radius: 16px;
            font-size: 18px;
            font-weight: 900;
            color: white;
            cursor: pointer;
            margin-top: 16px;
        }

        .victory-btn:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="top-bar">
            <button class="close-btn" onclick="window.location.href='module-3-simple.html'">√ó</button>
            <div id="progress-container">
                <div id="streak-label"></div>
                <div id="progress-bg">
                    <div id="progress-fill"></div>
                </div>
            </div>
        </div>

        <div id="content">
            <div class="mode-badge" id="mode-badge">learn</div>
            <div id="concept-section"></div>
            <div id="question-text"></div>
            <div id="choices"></div>
            
            <div id="feedback">
                <div class="check-icon">‚úì</div>
                <div id="feedback-text"></div>
            </div>
            
            <button id="continue-btn">Continue</button>
        </div>

        <div id="victory">
            <div class="victory-content">
                <div class="victory-icon">üéØ</div>
                <div id="victory-msg"></div>
                <div id="victory-badges"></div>
                <button class="victory-btn" onclick="window.location.href='module-3-simple.html'">Return to Module 3</button>
            </div>
        </div>
    </div>

    <script>
        (function checkPremiumAccess() {
            const userProgress = JSON.parse(localStorage.getItem('userProgress') || '{}');
            const isPremium = userProgress.premium === true;
            
            if (!isPremium) {
                alert('‚ö†Ô∏è Module 3 requires Premium access.\n\nUpgrade to unlock all 70+ figures!');
                window.location.href = 'main-menu-modules.html';
                return;
            }
        })();

        const state = {
            current: 0,
            total: 12,
            correct: 0,
            streak: 0,
            selected: null
        };

        const content = [
            // LEARN 1: What's different?
            {
                mode: 'learn',
                concept: 'A linear-quadratic system has one LINEAR equation (straight line) and one QUADRATIC equation (parabola/curve). They can intersect at 0, 1, or 2 points.',
                q: 'How is this different from linear systems?',
                choices: [
                    'One equation is curved (quadratic)',
                    'Both equations are curved',
                    'No difference',
                    'Three equations instead of two'
                ],
                answer: 'One equation is curved (quadratic)'
            },

            // LEARN 2: Number of solutions
            {
                mode: 'learn',
                concept: 'A line and parabola can cross at 0 points (no solution), 1 point (one solution), or 2 points (two solutions). This is different from linear systems!',
                q: 'Maximum number of solutions for a linear-quadratic system:',
                choices: [
                    '2 solutions',
                    '1 solution',
                    '3 solutions',
                    'Infinite solutions'
                ],
                answer: '2 solutions'
            },

            // LEARN 3: Using substitution
            {
                mode: 'learn',
                concept: 'Substitution works well here. If y = 2x + 1 (linear) and y = x¬≤ (quadratic), substitute to get x¬≤ = 2x + 1, then solve for x.',
                q: 'System: y = x + 3 and y = x¬≤. After substitution:',
                choices: [
                    'x¬≤ = x + 3',
                    'x = x¬≤',
                    'y = y',
                    'x¬≤ + x = 0'
                ],
                answer: 'x¬≤ = x + 3'
            },

            // LEARN 4: Solving the quadratic
            {
                mode: 'learn',
                concept: 'After substitution, you get a quadratic equation. Rearrange to standard form (= 0), then solve using factoring, quadratic formula, or completing the square.',
                q: 'After getting x¬≤ = x + 6, what should you do first?',
                choices: [
                    'Rearrange to x¬≤ - x - 6 = 0',
                    'Solve for y',
                    'Graph both equations',
                    'Add x to both sides'
                ],
                answer: 'Rearrange to x¬≤ - x - 6 = 0'
            },

            // PRACTICE
            {
                mode: 'practice',
                q: 'Which is a linear-quadratic system?',
                choices: [
                    'y = x + 2 and y = x¬≤',
                    'y = 2x and y = 3x + 1',
                    'y = x¬≤ and y = x¬≤ + 5',
                    'x + y = 5 and 2x + 2y = 10'
                ],
                answer: 'y = x + 2 and y = x¬≤'
            },

            {
                mode: 'practice',
                q: 'System: y = x and y = x¬≤ - 2. After substitution:',
                choices: [
                    'x = x¬≤ - 2',
                    'y = y',
                    'x¬≤ = 2',
                    'x - 2 = 0'
                ],
                answer: 'x = x¬≤ - 2'
            },

            {
                mode: 'practice',
                q: 'From x¬≤ - x - 2 = 0, which factors correctly?',
                choices: [
                    '(x - 2)(x + 1) = 0',
                    '(x - 1)(x + 2) = 0',
                    '(x - 2)(x - 1) = 0',
                    'Cannot factor'
                ],
                answer: '(x - 2)(x + 1) = 0'
            },

            {
                mode: 'practice',
                q: 'If (x - 3)(x + 2) = 0, what are the x-values?',
                choices: [
                    'x = 3 or x = -2',
                    'x = -3 or x = 2',
                    'x = 5',
                    'x = -1'
                ],
                answer: 'x = 3 or x = -2'
            },

            // CHALLENGE
            {
                mode: 'challenge',
                q: 'Solve: y = x + 1 and y = x¬≤. What are the solutions?',
                choices: [
                    '(2, 4) and (-1, 1)',
                    '(1, 2) only',
                    '(3, 9) only',
                    'No solution'
                ],
                answer: '(2, 4) and (-1, 1)'
            },

            {
                mode: 'challenge',
                q: 'System: y = 2x and y = x¬≤ + 1. How many solutions?',
                choices: [
                    'Two solutions',
                    'One solution',
                    'No solution',
                    'Three solutions'
                ],
                answer: 'Two solutions'
            },

            {
                mode: 'challenge',
                q: 'Solve: y = x and y = x¬≤ - 6. After rearranging: x¬≤ - x - 6 = 0. What is x?',
                choices: [
                    'x = 3 or x = -2',
                    'x = 2 or x = -3',
                    'x = 6 only',
                    'x = -6 only'
                ],
                answer: 'x = 3 or x = -2'
            },

            {
                mode: 'challenge',
                q: 'If you found x = 2 and x = -1, and y = x + 3, what are the full solutions?',
                choices: [
                    '(2, 5) and (-1, 2)',
                    '(5, 2) and (2, -1)',
                    '(2, 3) and (-1, 3)',
                    '(2, -1) only'
                ],
                answer: '(2, 5) and (-1, 2)'
            }
        ];

        const feedback = {
            correct: ['Perfect!', 'Excellent!', 'You got it!', 'Brilliant!', 'Yes!'],
            wrong: ['Not quite', 'Try again', 'Almost']
        };

        const letters = ['A', 'B', 'C', 'D'];

        function showContent() {
            const item = content[state.current];
            
            document.getElementById('mode-badge').className = 'mode-badge ' + item.mode;
            document.getElementById('mode-badge').textContent = item.mode;

            if (item.concept) {
                let html = `<div class="concept-box"><div class="concept-text">${item.concept}</div></div>`;
                document.getElementById('concept-section').innerHTML = html;
            } else {
                document.getElementById('concept-section').innerHTML = '';
            }

            document.getElementById('question-text').innerHTML = item.q;
            
            const choicesHTML = item.choices.map((c, i) => 
                `<button class="choice" data-choice="${i}" data-letter="${letters[i]}">${c}</button>`
            ).join('');
            document.getElementById('choices').innerHTML = choicesHTML;
            
            document.querySelectorAll('.choice').forEach(btn => {
                btn.addEventListener('click', function() {
                    const choiceIndex = parseInt(this.getAttribute('data-choice'));
                    selectChoice(item.choices[choiceIndex]);
                });
            });
            
            document.getElementById('continue-btn').classList.remove('show');
            document.getElementById('progress-fill').style.width = ((state.current / state.total) * 100) + '%';
            
            if (state.streak >= 2) {
                document.getElementById('streak-label').textContent = state.streak + ' IN A ROW';
            }
            
            document.getElementById('feedback-text').textContent = '';
            document.querySelector('.check-icon').classList.remove('show');
            state.selected = null;
        }

        function selectChoice(choice) {
            if (state.selected) return;
            
            state.selected = choice;
            const item = content[state.current];
            const btns = document.querySelectorAll('.choice');
            
            btns.forEach(btn => {
                btn.disabled = true;
                const btnText = btn.textContent;
                
                if (btnText === choice) {
                    btn.classList.add('selected');
                    
                    setTimeout(() => {
                        if (choice === item.answer) {
                            btn.classList.add('correct');
                            state.correct++;
                            state.streak++;
                            
                            const feedbackMsg = feedback.correct[Math.floor(Math.random() * feedback.correct.length)];
                            document.getElementById('feedback-text').textContent = feedbackMsg;
                            document.querySelector('.check-icon').classList.add('show');
                            document.getElementById('continue-btn').classList.add('show');
                            
                        } else {
                            btn.classList.add('incorrect');
                            state.streak = 0;
                            document.getElementById('streak-label').textContent = '';
                            
                            setTimeout(() => {
                                btn.classList.remove('selected', 'incorrect');
                                btns.forEach(b => b.disabled = false);
                                state.selected = null;
                            }, 1200);
                        }
                    }, 300);
                }
            });
        }

        function nextContent() {
            state.current++;
            if (state.current < state.total) {
                showContent();
            } else {
                showVictory();
            }
        }

        function showVictory() {
            const perfect = state.correct === 12;
            
            document.getElementById('victory-msg').textContent = perfect ? 
                'Perfect! You mastered linear-quadratic systems!' : 
                'Great work! You completed Figure 026!';
            
            let badgesHTML = '';
            if (perfect) badgesHTML += '<div class="badge">Flawless</div>';
            if (state.streak >= 5) badgesHTML += '<div class="badge">On Fire</div>';
            
            document.getElementById('victory-badges').innerHTML = badgesHTML || '<div class="badge">Complete</div>';
            document.getElementById('victory').classList.add('show');
            
            const progress = JSON.parse(localStorage.getItem('userProgress') || '{"completed": [], "xp": 0}');
            if (!progress.completed.includes('figure-026')) {
                progress.completed.push('figure-026');
                progress.xp += 150;
            }
            localStorage.setItem('userProgress', JSON.stringify(progress));
        }

        document.getElementById('continue-btn').addEventListener('click', nextContent);
        
        showContent();
    </script>
</body>
</html>
